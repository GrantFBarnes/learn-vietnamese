<app-unauthorized
  *ngIf="!authorized"
  (authorizeEvent)="authorize()"
></app-unauthorized>

<div *ngIf="authorized" class="container">
  <app-title [title]="{ english: 'Connections', vietnamese: '' }"></app-title>

  <div class="row mb-2">
    <div class="col-md-6 mb-2">
      <h3>
        Total Connections: <code>{{ total_connections }}</code>
      </h3>
    </div>
    <div class="col-md-6 mb-2">
      <h3>
        Total IP Addresses: <code>{{ ip_connections_list.length }}</code>
      </h3>
    </div>
  </div>
  <div class="row mb-2">
    <div class="col-12 mb-2">
      <table class="table table-dark">
        <thead>
          <tr>
            <th class="center">
              <div class="clickable" (click)="toggleIPShowAll()">
                <i *ngIf="!ip_show_all" class="bi bi-chevron-down"></i>
                <i *ngIf="ip_show_all" class="bi bi-chevron-up"></i>
              </div>
            </th>
            <th>IP Address</th>
            <th>Connections</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let ip of ip_connections_list">
            <tr>
              <td class="center">
                <div class="clickable" (click)="toggleIPShow(ip)">
                  <i *ngIf="!ip_show[ip]" class="bi bi-chevron-down"></i>
                  <i *ngIf="ip_show[ip]" class="bi bi-chevron-up"></i>
                </div>
              </td>
              <td>{{ ip }}</td>
              <td>{{ ip_connections[ip].length }}</td>
            </tr>
            <tr *ngIf="ip_show[ip]">
              <td></td>
              <td colspan="2">
                <table class="table table-dark">
                  <thead>
                    <tr>
                      <th>Method</th>
                      <th>URL</th>
                      <th>API</th>
                      <th>Time</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let connection of ip_connections[ip]">
                      <td>{{ connection.method }}</td>
                      <td>{{ connection.url }}</td>
                      <td>{{ connection.is_api ? "True" : "False" }}</td>
                      <td>{{ connection.time }}</td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>
